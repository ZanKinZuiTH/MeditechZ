<UserControl xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"   xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"  xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"  xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol" x:Class="MediTech.Views.DoctorRoom"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:uc="clr-namespace:MediTech.CustomControl.Banner"
             xmlns:mvvm="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Platform"
             xmlns:cv="clr-namespace:MediTech.Converter"
             xmlns:cc="clr-namespace:MediTech.CustomControl"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             mc:Ignorable="d"
             xmlns:vm="clr-namespace:MediTech.Views"
             DataContext="{Binding Path=DoctorRoomViewModel,Source={StaticResource Locator}}"
             d:DesignHeight="600" d:DesignWidth="900">
    <UserControl.Resources>
        <cc:PatientSearchPopUp x:Key="PatientColumn" d:IsDataSource="True" />

        <DataTemplate x:Key="DetailCoreTemplate">
            <dx:MeasurePixelSnapper>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="วันที่"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Margin="5,0,0,0"
                               FontWeight="Bold"
                               Text="{Binding Row.StartDttm,StringFormat=dd/MM/yyy HH:mm}"/>
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="แพทย์"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Margin="5,0,0,0" 
                               FontWeight="Bold"
                               Text="{Binding Row.CareProviderName}"/>
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="สถานะ"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" Margin="5,0,0,0"
                               FontWeight="Bold"
                               Text="{Binding Row.VisitStatus}"/>

                </Grid>
            </dx:MeasurePixelSnapper>
        </DataTemplate>
        <ControlTemplate x:Key="detailContainerTemplate" TargetType="{x:Type ContentControl}">
            <Border BorderThickness="0,1,0,0" BorderBrush="{TemplateBinding BorderBrush}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Padding="12,12,12,12" Background="{TemplateBinding Background}">
                <ContentPresenter />
            </Border>
        </ControlTemplate>
        <DataTemplate x:Key="expandableRowDetailTemplate">
            <StackPanel Orientation="Vertical">
                <dx:MeasurePixelSnapper>
                    <ContentPresenter x:Name="defaultRowPresenter" Content="{Binding}" ContentTemplate="{Binding View.DefaultDataRowTemplate}" />
                </dx:MeasurePixelSnapper>
                <dx:DXExpander IsExpanded="{Binding Path=IsSelected}" HorizontalExpand="None" VerticalExpand="FromTopToBottom">
                    <dxg:RowDetailContainerControl Template="{StaticResource detailContainerTemplate}" Content="{Binding}" ContentTemplate="{DynamicResource DetailCoreTemplate}" />
                </dx:DXExpander>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>
    <Grid >
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid Grid.Column="0">
            <dxlc:LayoutControl Orientation="Vertical"
                                MaxWidth="250"
                                Padding="0">
                <dxlc:LayoutGroup Orientation="Vertical" Padding="-5"
                                  View="GroupBox" Header="ค้นหา">
                    <dxlc:LayoutItem Name="layoutSearchPatient" Label="ผู้ป่วย">
                        <cc:AutoCompleteTextBox     Text="{Binding SearchPatientCriteria,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                    ColumnsSource="{Binding Path=Columns,Source={StaticResource PatientColumn}}"
                                                    OnTextChangedEvent="False"
                                                    Binding="{Binding PatientName}"
                                                    MaxCompletions="30"
                                                    ItemsSource="{Binding PatientsSearchSource}"
                                                    SelectedItem="{Binding SelectedPateintSearch,Mode=OneWayToSource}"
                                                    >
                            <cc:AutoCompleteTextBox.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding PatientSearchCommand}" />

                            </cc:AutoCompleteTextBox.InputBindings>
                        </cc:AutoCompleteTextBox>
                    </dxlc:LayoutItem>
                    <dxlc:LayoutItem Label="แพทย์">
                        <dxe:ComboBoxEdit x:Name="cmbDoctor"
                                              ItemsSource="{Binding Doctors}"
                                              SelectedItem="{Binding SelectDoctor}"
                                              IsTextEditable="True" 
                                              DisplayMember="FullName"
                                              AllowNullInput="True"
                                              ValueMember="CareproviderUID"
                                              />
                    </dxlc:LayoutItem>
                    <dxlc:LayoutItem Label="วันที่">
                        <dxe:DateEdit EditValue="{Binding VisitDate}"/>
                    </dxlc:LayoutItem>
                    <dxlc:LayoutItem Label="สถานะ" >
                        <dxe:ComboBoxEdit x:Name="cmbStatus"
                                              ItemsSource="{Binding VisitStatus}"
                                              IsTextEditable="False" 
                                              DisplayMember="Display"
                                              ValueMember="Key"
                                              EditValue="{Binding Path=SelectVisitStatusList,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                              SelectedItem="{Binding Path=SelectVisitStatus,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                            <dxe:ComboBoxEdit.StyleSettings>
                                <dxe:CheckedComboBoxStyleSettings />
                            </dxe:ComboBoxEdit.StyleSettings>
                        </dxe:ComboBoxEdit>
                    </dxlc:LayoutItem>
                    <dxlc:LayoutItem Label="สถานประกอบการ">
                        <dxe:ComboBoxEdit Name="cmbOrganisation" 
                                      ItemsSource="{Binding Organisations}" 
                                      SelectedItem="{Binding SelectOrganisation}"
                                      ValueMember="HealthOrganisationUID"
                                      DisplayMember="Name"
                                      AutoComplete="True"
                                      NullValueButtonPlacement="EditBox"
                                      ImmediatePopup="True"/>
                    </dxlc:LayoutItem>
                </dxlc:LayoutGroup>

                <dxlc:GroupBox Padding="0">
                    <dxlc:GroupBox.HeaderTemplate>
                        <DataTemplate >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="คิวผู้ป่วย" />
                                <Button Name="imaRefersh" Grid.Column="1" 
                                        Command="{Binding DataContext.RefershPatientCommand,RelativeSource={RelativeSource AncestorType={x:Type vm:DoctorRoom}}}"
                                        ToolTip="Refersh"
                                        HorizontalAlignment="Right">
                                    <Image Source="/MediTech;component/Resources/Images/Action/Refersh.png" Width="20" Height="20"   />
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </dxlc:GroupBox.HeaderTemplate>

                    <dxg:GridControl  ItemsSource="{Binding PatientVisits}"
                                 SelectedItem="{Binding SelectPatientVisit}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger  EventName="MouseDoubleClick">
                                <mvvm:EventToCommand Command="{Binding VisitMedicalCommand}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn Header="BN" FieldName="PatientID"
                                            Width="80"
                                            HorizontalHeaderContentAlignment="Center"
                                            ReadOnly="True">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings AcceptsReturn="True" 
                                                          TextWrapping="Wrap"/>
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn Header="ชื่อผู้ป่วย" 
                                             HorizontalHeaderContentAlignment="Center"
                                            FieldName="PatientName" ReadOnly="True">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings AcceptsReturn="True" 
                                                          TextWrapping="Wrap"/>
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                        </dxg:GridControl.Columns>
                        <dxg:GridControl.View>
                            <dxg:TableView ShowGroupPanel="False" 
                                           ShowColumnHeaders="False"
                                           ShowIndicator="False"
                                           AllowEditing="False" 
                                           ShowVerticalLines="False"
                                           AllowScrollAnimation="True" 
                                           UseLightweightTemplates="None"
                                           NavigationStyle="Row"
                                           VerticalScrollbarVisibility="Auto"
                                           DataRowTemplate="{StaticResource expandableRowDetailTemplate}"
                                           AutoWidth="True"/>
                        </dxg:GridControl.View>
                    </dxg:GridControl>

                </dxlc:GroupBox>

            </dxlc:LayoutControl>

        </Grid>
        <Grid Grid.Column="1" IsEnabled="{Binding IsEnableControl}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <dxlc:LayoutControl Grid.Row="0"
                            Padding="10,0,10,0"
                            Orientation="Vertical" >
                <dxlc:LayoutItem >
                    <uc:PatientBanner x:Name="PatientBanner" 
                                  PatientVisit="{Binding SelectVisitMedical}"/>
                </dxlc:LayoutItem>

                <dxlc:LayoutGroup Orientation="Horizontal">
                    <dxlc:LayoutGroup Orientation="Horizontal"
                              HorizontalAlignment="Left">
                        <dxlc:LayoutItem>
                            <Border BorderThickness="2" 
                            BorderBrush="#FF6396E0"
                            Background="White"
                            CornerRadius="4" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger  EventName="MouseLeftButtonUp">
                                        <mvvm:EventToCommand Command="{Binding PastMedicalCommand}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <StackPanel Orientation="Horizontal"
                                    Margin="8,0,8,0"
                                    Cursor="Hand">
                                    <Image Width="25"
                                   Height="25"
                                   Source="/MediTech;component/Resources/Images/Other/PATEINTHISTORY.png"
                                   ToolTip="MEDICAL DISCHARGE" />
                                    <TextBlock VerticalAlignment="Center"
                                       FontSize="11"
                                       FontWeight="Bold"
                                       Text="ประวัติเก่า" />
                                </StackPanel>
                            </Border>
                        </dxlc:LayoutItem>
                        <dxlc:LayoutItem>
                            <Border BorderThickness="2"
                            BorderBrush="#FF6396E0"
                            Cursor="Hand"
                            Background="White"
                            CornerRadius="4" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger  EventName="MouseLeftButtonUp">
                                        <mvvm:EventToCommand Command="{Binding VitalSignCommand}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <StackPanel Orientation="Horizontal"
                                    Margin="8,0,8,0"
                                    Cursor="Hand">
                                    <Image Width="25"
                                   Height="25"
                                   Source="/MediTech;component/Resources/Images/Medical/VitalSign.png"
                                   ToolTip="MEDICAL DISCHARGE" />
                                    <TextBlock VerticalAlignment="Center"
                                       FontSize="11"
                                       FontWeight="Bold"
                                       Text="Vital Sign" />
                                </StackPanel>
                            </Border>
                        </dxlc:LayoutItem>
                        <dxlc:LayoutItem>
                            <Border BorderThickness="2"
                            Background="White"
                            BorderBrush="#FF6396E0" 
                            CornerRadius="4" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger  EventName="MouseLeftButtonUp">
                                        <mvvm:EventToCommand Command="{Binding AllergyCommand}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <StackPanel Orientation="Horizontal"
                                    Margin="8,0,8,0"
                                    Cursor="Hand">
                                    <Image Width="25"
                                   Height="25"
                                   Source="/MediTech;component/Resources/Images/Medical/Allergy2.png"
                                   ToolTip="MEDICAL DISCHARGE" />
                                    <TextBlock VerticalAlignment="Center"
                                       FontSize="11"
                                       FontWeight="Bold"
                                       Text="แพ้ยา" />
                                </StackPanel>
                            </Border>
                        </dxlc:LayoutItem>
                        <dxlc:LayoutItem>
                            <Border BorderThickness="2" 
                            Background="White"
                            BorderBrush="#FF6396E0" 
                            CornerRadius="4" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger  EventName="MouseLeftButtonUp">
                                        <mvvm:EventToCommand Command="{Binding AppointmentCommand}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <StackPanel Orientation="Horizontal"
                                    Margin="8,0,8,0"
                                    Cursor="Hand">
                                    <Image Width="25"
                                   Height="25"
                                   Source="/MediTech;component/Resources/Images/Other/ShortDate_32x32.png"
                                   ToolTip="MEDICAL DISCHARGE" />
                                    <TextBlock VerticalAlignment="Center"
                                       FontSize="11"
                                       FontWeight="Bold"
                                       Text="ทำนัด" />
                                </StackPanel>
                            </Border>
                        </dxlc:LayoutItem>
                        <dxlc:LayoutItem>
                            <Border BorderThickness="2" 
                            BorderBrush="#FF6396E0"
                            Background="White"
                            CornerRadius="4" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger  EventName="MouseLeftButtonUp">
                                        <mvvm:EventToCommand Command="{Binding MedicalDischageCommand}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <StackPanel Orientation="Horizontal" 
                                    Margin="8,0,8,0"
                                    Cursor="Hand">
                                    <Image x:Name="imgmeddischage"
                                   Width="25"
                                   Height="25"
                                   Source="/MediTech;component/Resources/Images/Medical/MEDDISCHARGE.png"
                                   ToolTip="MEDICAL DISCHARGE" />
                                    <TextBlock x:Name="tbmeddischarge"
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       FontWeight="Bold"
                                       Text="จบการรักษา" />
                                </StackPanel>
                            </Border>
                        </dxlc:LayoutItem>

                    </dxlc:LayoutGroup>
                    <dxlc:LayoutItem HorizontalAlignment="Right">
                        <Image x:Name="RefershData"
                                   Width="30"
                                   Height="30"
                                   Cursor="Hand"
                                   Source="/MediTech;component/Resources/Images/Action/Refersh.png"
                                   ToolTip="Refersh Data" >
                            <i:Interaction.Triggers>
                                <i:EventTrigger  EventName="MouseLeftButtonDown">
                                    <mvvm:EventToCommand Command="{Binding DataContext.RefershDataCommand,RelativeSource={RelativeSource AncestorType={x:Type vm:DoctorRoom}}}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Image.Style>
                                <Style TargetType="{x:Type Image}">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="OpacityMask" Value="#A2000000"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Image.Style>
                        </Image>
                    </dxlc:LayoutItem>
                </dxlc:LayoutGroup>

                <dxlc:LayoutItem Margin="0,-5,0,0">
                    <Expander IsExpanded="{Binding IsExpandVitalSign}" >
                        <Expander.Header>
                            <TextBlock Text="Vital Sign ล่าสุด"                                   
                                   FontStyle="Italic"
                                   FontWeight="Bold"
                                   FontSize="11"
                                   Foreground="Blue"/>
                        </Expander.Header>
                        <Expander.Content>
                            <dxlc:LayoutControl Orientation="Horizontal"  Padding="0,-4,0,0">
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem>
                                        <StackPanel Orientation="Horizontal"  HorizontalAlignment="Center">
                                            <TextBlock Text="อุณหภูมิ" Foreground="Blue"
                                                   FontSize="14"/>
                                            <TextBlock Text="{Binding Temprature}"
                                   FontSize="14" Margin="5,0,5,0"
                                   FontWeight="Bold"/>
                                            <TextBlock Text="องศาเซลเซียส" Foreground="Gray"
                                                   FontSize="14"  />
                                        </StackPanel>
                                    </dxlc:LayoutItem>

                                </dxlc:LayoutGroup>
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="ชีพจร" Foreground="Blue" FontSize="14" />
                                            <TextBlock Text="{Binding Pulse}" Name="txtPluse" Margin="5,0,5,0"
                                                   FontSize="14" FontWeight="Bold" />
                                            <TextBlock Text="ครั้ง/นาที" Foreground="Gray" FontSize="14"/>
                                        </StackPanel>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="อัตราการหายใจ" Foreground="Blue" FontSize="14"/>
                                            <TextBlock Text="{Binding RespiratoryRate}" Name="txtRes"
                                                   Margin="5,0,5,0"
                                                   FontSize="14"
                                   FontWeight="Bold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="ครั้ง/นาที" Foreground="Gray" FontSize="14"/>
                                        </StackPanel>
                                    </dxlc:LayoutItem>

                                </dxlc:LayoutGroup>

                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ความดันบน" Foreground="Blue" FontSize="14"/>
                                            <TextBlock Text="{Binding BPsys}" Name="txtSBP" 
                                                   Margin="5,0,5,0"
                                                   FontSize="14" FontWeight="Bold" />
                                            <TextBlock Text="mm Hg" Foreground="Gray" FontSize="14"/>
                                        </StackPanel>
                                    </dxlc:LayoutItem>

                                </dxlc:LayoutGroup>

                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ความดันล่าง" Foreground="Blue" FontSize="14"/>
                                            <TextBlock Text="{Binding BPDio}" Name="txtDBP"
                                                   Margin="5,0,5,0"
                                                   FontSize="14" FontWeight="Bold"/>

                                            <TextBlock Text="mm Hg" Foreground="Gray" FontSize="14"/>
                                        </StackPanel>
                                    </dxlc:LayoutItem>

                                </dxlc:LayoutGroup>

                            </dxlc:LayoutControl>
                        </Expander.Content>
                    </Expander>
                </dxlc:LayoutItem>
            </dxlc:LayoutControl>
            <dxlc:LayoutControl Padding="0" Grid.Row="1">
                <vm:SummeryView  x:Name="summeryView" Height="Auto"
                        PatientVisit="{Binding Path=DataContext.SelectVisitMedical
                        ,RelativeSource={RelativeSource AncestorType={x:Type vm:DoctorRoom}}}"/>
            </dxlc:LayoutControl>
        </Grid>


    </Grid>
</UserControl>
